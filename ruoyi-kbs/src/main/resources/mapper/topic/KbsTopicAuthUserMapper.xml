<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.kbs.mapper.KbsTopicAuthUserMapper">

    <resultMap type="KbsTopicAuthUser" id="KbsTopicAuthUserResult">
        <result property="id" column="id"/>
        <result property="topicId" column="topic_id"/>
        <result property="userId" column="user_id"/>
        <result property="name" column="name"/>
        <result property="type" column="type"/>
        <result property="sort" column="sort"/>
        <result property="deptId" column="dept_id"/>
        <result property="createId" column="create_id"/>
        <result property="createTime" column="create_time"/>
        <result property="updateId" column="update_id"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="selectKbsTopicAuthUserVo">
        select id,
               topic_id,
               user_id,
               name,
               type,
               sort,
               dept_id,
               create_id,
               create_time,
               update_id,
               update_time
        from t_kbs_topic_auth_user
    </sql>

    <select id="selectKbsTopicAuthUserList" parameterType="KbsTopicAuthUser" resultMap="KbsTopicAuthUserResult">
        <include refid="selectKbsTopicAuthUserVo"/>
        <where>
            del_flag = '0'
            <if test="topicId != null  and topicId != ''">and topic_id = #{topicId}</if>
            <if test="userId != null ">and user_id = #{userId}</if>
            <if test="name != null  and name != ''">and name like concat('%', #{name}, '%')</if>
            <if test="type != null  and type != ''">and type = #{type}</if>
            <if test="sort != null  and sort != ''">and sort = #{sort}</if>
            <if test="deptId != null ">and dept_id = #{deptId}</if>
            <if test="createId != null ">and create_id = #{createId}</if>
            <if test="createTime != null ">and create_time = #{createTime}</if>
        </where>
        order by sort, create_time
    </select>

    <select id="selectKbsTopicAuthUserById" parameterType="String" resultMap="KbsTopicAuthUserResult">
        <include refid="selectKbsTopicAuthUserVo"/>
        where del_flag = '0' and id = #{id}
    </select>

    <insert id="insertKbsTopicAuthUser" parameterType="KbsTopicAuthUser">
        insert into t_kbs_topic_auth_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null and id != ''">id,</if>
            <if test="topicId != null and topicId != ''">topic_id,</if>
            <if test="userId != null">user_id,</if>
            <if test="name != null">name,</if>
            <if test="type != null">type,</if>
            <if test="sort != null">sort,</if>
            <if test="deptId != null">dept_id,</if>
            <if test="createId != null">create_id,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateId != null">update_id,</if>
            <if test="updateTime != null">update_time,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null and id != ''">#{id},</if>
            <if test="topicId != null and topicId != ''">#{topicId},</if>
            <if test="userId != null">#{userId},</if>
            <if test="name != null">#{name},</if>
            <if test="type != null">#{type},</if>
            <if test="sort != null">#{sort},</if>
            <if test="deptId != null">#{deptId},</if>
            <if test="createId != null">#{createId},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateId != null">#{updateId},</if>
            <if test="updateTime != null">#{updateTime},</if>
        </trim>
    </insert>

    <update id="updateKbsTopicAuthUser" parameterType="KbsTopicAuthUser">
        update t_kbs_topic_auth_user
        <trim prefix="SET" suffixOverrides=",">
            <if test="topicId != null and topicId != ''">topic_id = #{topicId},</if>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="name != null">name = #{name},</if>
            <if test="type != null">type = #{type},</if>
            <if test="sort != null">sort = #{sort},</if>
            <if test="deptId != null">dept_id = #{deptId},</if>
            <if test="createId != null">create_id = #{createId},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateId != null">update_id = #{updateId},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </trim>
        where id = #{id}
    </update>

    <insert id="batchInsert" parameterType="KbsTopicAuthUser">
        insert into t_kbs_topic_auth_user (id, topic_id, user_id, name, type, sort, dept_id, create_id, create_time,
        update_id, update_time) values
        <foreach item="item" index="index" collection="list" separator=",">
            (#{item.id}, #{item.topicId}, #{item.userId}, #{item.name}, #{item.type}, #{item.sort}, #{item.deptId},
            #{item.createId}, #{item.createTime}, #{item.updateId}, #{item.updateTime})
        </foreach>
    </insert>

    <select id="selectListByTopicId" parameterType="String" resultMap="KbsTopicAuthUserResult">
        select *
        from t_kbs_topic_auth_user
        where del_flag = '0' and topic_id = #{topicId}
        order by sort, create_time
    </select>

    <select id="selectKbsTopicAuthUserByUserId" parameterType="String" resultMap="KbsTopicAuthUserResult">
        <include refid="selectKbsTopicAuthUserVo"/>
        where del_flag = '0' and user_id = #{userId}
        order by sort, create_time
    </select>

    <select id="selectMyTopicAuthUser" parameterType="KbsTopicAuthUserQo" resultMap="KbsTopicAuthUserResult">
        <include refid="selectKbsTopicAuthUserVo"/>
        where del_flag = '0' and topic_id = #{topicId} and user_id = #{userId}
    </select>

    <update id="updateDelFlagByTopicIds" parameterType="KbsTopicAuthUserUpdateQo">
        update t_kbs_topic_auth_user
        set del_flag = #{delFlag}, update_id = #{updateId}, update_time = #{updateTime}
        where topic_id in
        <foreach item="topicId" collection="topicIds" open="(" separator="," close=")">
            #{topicId}
        </foreach>
    </update>
</mapper>